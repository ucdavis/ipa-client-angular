<nav
  year="{{ year }}"
  term-short-code="{{ termShortCode }}"
  workgroup-id="{{ workgroupId }}"
></nav>

<div class="support-call-response-report-container">
  <ipa-header page-title="Support Call Response Report"></ipa-header>

  <!-- handle no access -->
  <div ng-if="noAccess">
    <no-access workgroup-name="sharedState.workgroup.name"></no-access>
  </div>

  <!-- handle lack of teaching call data-->
  <div ng-if="!noAccess && view.state && view.state.supportCallResponses.length === 0">
    <div
      class="jumbotron"
      style="text-align: center; height: 100%; background-color: white;"
    >
      <p class="lead">
        No Support Call Responses found for {{sharedState.workgroup.name}} {{
        year.yearToAcademicYear() }}
      </p>
    </div>
  </div>

  <div ng-if="!noAccess && view.state && view.state.supportCallResponses.length > 0" class="main-content">
    <!-- Toolbar -->
    <div class="row hidden-print">
      <div class="table-toolbar">
        <div class="btn-group">
          <span
            data-toggle="tooltip"
            data-placement="top"
            data-original-title="Download as Excel"
            data-container="body"
            ng-click="download()"
            class="tool-icon glyphicon glyphicon-download-alt"
            aria-haspopup="true"
            aria-expanded="false"
          >
          </span>
          <ul class="dropdown-menu">
            <li>
              <a href="#" class="small">as Excel</a>
            </li>
            <li><a href="#" class="small">as CSV</a></li>
          </ul>
        </div>
        <span
          data-toggle="tooltip"
          data-placement="top"
          data-original-title="Print"
          ng-click="print()"
          class="tool-icon glyphicon glyphicon-print"
        ></span>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>
            Students
          </th>
          <!-- <th ng-repeat="termCode in view.state.termCodes">
            {{ getTermName(termCode) }}
          </th> -->
          <th style="width: 33%;">Availabilities</th>
          <th style="width: 33%;">Preferences</th>
          <th style="width: 33%;">Comments</th>
        </tr>
      </thead>
      <tbody>
        <!-- table body (row pairs) -->
        <tr
          ng-repeat-start="supportStaff in view.state.supportStaff | orderBy: 'lastName'"
          style="border-bottom: none;"
        >
          <td
            style="
              font-weight: bold;
              font-size: 14px;
              overflow: hidden;
              padding: 20px 15px 20px 15px;
            "
          >
            {{ supportStaff.lastName }}, {{ supportStaff.firstName }}
            <i
              ng-if="supportStaff.supportCallResponse.submitted"
              class="green glyphicon glyphicon-ok"
              uib-tooltip="Submitted Preferences"
              tooltip-placement="top"
              tooltip-append-to-body="true"
            ></i>
          </td>

          <!-- availabilities -->
          <td>
            <div style="margin: 20px;">
            <availability-grid blob="supportStaff.supportCallResponse.availabilityBlob"
              read-only="true"></availability-grid>
            </div>
          </td>

          <!-- preferences -->
          <td>
            <div style="padding: 20px 15px 20px 15px;">
              <div class="preferences-cell">
                <div ng-repeat="preference in supportStaff.preferences" style="background-color: #ddd; margin: 10px; padding: 10px;">
                  <p ng-init="course = view.state.courses[view.state.sectionGroups[preference.sectionGroupId].courseId]">
                    Priority: {{ preference.priority }}. {{ course.subjectCode }} {{ course.courseNumber }} - {{ preference.type === 'teachingAssistant' ? "Teaching Assistant" : "Reader"}} 
                    </p>
                    <p>
                      Comment: {{ preference.comment }}
                    </p>
                </div>
              </div>
            </div>
          </td>

          <!-- comment row -->
          <td>
            <div style="padding: 20px 15px 20px 15px;">
              <div class="comment-cell">
              {{ supportStaff.supportCallResponse.generalComments }}
              </div>
            </div>
          </td>
        </tr>
        <tr ng-repeat-end>
          <td ng-repeat="termCode in view.state.termCodes">
            <div
              ng-if="instructor.availabilityByTermCode[termCode].length > 0"
              style="padding: 20px 15px 20px 15px;"
            >
              <div
                ng-repeat="availability in instructor.availabilityByTermCode[termCode]"
              >
                <b>{{ availability.day }}</b> {{ availability.times }}
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<back-to-top></back-to-top>
